rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Admin users can read/write all data
    function isAdmin() {
      return request.auth != null && 
        request.auth.token.email in [
          'admin@mitoderm.com',
          'shiri@mitoderm.com',
          'segev@futurixs.com',
          'ilona@mitoderm.co.il'
        ];
    }
    
    // Products collection
    match /products/{productId} {
      allow read: if true; // Anyone can read products
      allow write: if isAdmin(); // Only admins can write
    }
    
    // Videos collection
    match /videos/{videoId} {
      allow read: if true; // Anyone can read videos
      allow write: if isAdmin(); // Only admins can write
    }
    
    // Certification requests
    match /certificationRequests/{requestId} {
      allow read: if request.auth != null; // Authenticated users can read
      allow create: if request.auth != null; // Authenticated users can create
      allow update: if isAdmin(); // Only admins can update
      allow delete: if isAdmin(); // Only admins can delete
    }
    
    // Categories collection
    match /categories/{categoryId} {
      allow read: if true; // Anyone can read categories
      allow write: if isAdmin(); // Only admins can write
    }
    
    // Rewards collection
    match /rewards/{rewardId} {
      allow read: if true; // Anyone can read rewards
      allow write: if isAdmin(); // Only admins can write
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
      allow write: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }
  }
}